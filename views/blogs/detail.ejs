<%- include("../partials/head.ejs") %>
<body>
  <%- include('../partials/nav.ejs') %>

  <main class="container py-5">
    <div class="card shadow-lg">
      <% if (blog.image && blog.image.filename) { %>
      <img
        src="/uploads/<%= blog.image.filename %>"
        class="card-img-top"
        alt="Blog Image"
      />
      <% } %>
      <div class="card-body">
        <h2 class="card-title mb-3"><%= blog.title %></h2>
        <p class="card-text fs-5"><%= blog.body %></p>

        <div class="mt-4 d-flex justify-content-between">
          <a href="/blogs" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Back to Blogs
          </a>

          <a href="#" class="btn btn-danger delete" data-doc="<%= blog._id %>">
            <i class="bi bi-trash"></i> Delete Blog
          </a>
        </div>
      </div>
    </div>
  </main>

  <%- include('../partials/footer.ejs') %>

  <script>
    const trashCan = document.querySelector("a.delete");

    trashCan.addEventListener("click", (event) => {
      event.preventDefault();
      const endpoint = `/blogs/${trashCan.dataset.doc}`;

      if (confirm("Are you sure you want to delete this blog?")) {
        fetch(endpoint, {
          method: "DELETE",
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.redirect) {
              window.location.href = data.redirect;
            } else {
              alert("Failed to delete blog.");
            }
          })
          .catch((err) =>
            console.error(`Error deleting blog ${trashCan.dataset.doc}:`, err)
          );
      }
    });
  </script>
</body>
