<%- include("../partials/head.ejs") %>
<body>
  <%- include('../partials/nav.ejs') %>

  <main class="container pb-5">
    <nav aria-label="Breadcrumb" class="mb-3 d-flex justify-content-between">
      <a class="icon-link icon-link-hover" href="/blogs">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="bi"
          viewBox="0 0 16 16"
          aria-hidden="true"
          width="16"
          height="16"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M15 8a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 0 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 7.5H14.5a.5.5 0 0 1 .5.5z"
          />
        </svg>
        <span>Back to Blogs</span>
      </a>
      <div class="d-flex gap-2">
        <button
          class="btn btn-danger delete"
          data-doc="<%= blog._id %>"
          aria-label="Delete blog post"
        >
          <i class="bi bi-trash" aria-hidden="true"></i>
        </button>

        <%- include("./editModal", {blog}) %>
      </div>
    </nav>

    <article class="card shadow-lg" aria-labelledby="blog-title">
      <% if (blog.image && blog.image.filename) { %>
      <img
        src="/uploads/<%= blog.image.filename %>"
        class="card-img-top"
        style="height: 300px"
        alt="<%= blog.title %> featured image"
      />
      <% } %>
      <div class="card-body">
        <h2 id="blog-title" class="card-title mb-3"><%= blog.title %></h2>
        <p class="card-text fs-5"><%= blog.body %></p>
      </div>
    </article>
    <div id="delete-status" class="visually-hidden" aria-live="polite"></div>
  </main>

  <%- include('../partials/footer.ejs') %>

  <script>
    const trashButton = document.querySelector(".delete");

    trashButton?.addEventListener("click", (event) => {
      event.preventDefault();
      const endpoint = `/blogs/${trashButton.dataset.doc}`;

      if (confirm("Are you sure you want to delete this blog?")) {
        fetch(endpoint, {
          method: "DELETE",
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.redirect) {
              window.location.href = data.redirect;
            } else {
              document.getElementById("delete-status").textContent =
                "Failed to delete blog.";
            }
          })
          .catch((err) => {
            console.error(
              `Error deleting blog ${trashButton.dataset.doc}:`,
              err
            );
            document.getElementById("delete-status").textContent =
              "An error occurred while deleting.";
          });
      }
    });
  </script>
</body>
